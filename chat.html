<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI èŠå¤©æ©Ÿå™¨äºº</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
      background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      height:100vh; display:flex; justify-content:center; align-items:center;
    }
    .chat-container {
      width:90%; max-width:800px; height:80vh; background:#fff; border-radius:20px;
      box-shadow:0 20px 40px rgba(0,0,0,.1); display:flex; flex-direction:column; overflow:hidden;
    }
    .chat-header { background:linear-gradient(135deg,#4f46e5 0%,#7c3aed 100%); color:#fff; padding:20px; text-align:center; font-size:1.2em; font-weight:600; }
    .chat-messages { flex:1; padding:20px; overflow-y:auto; display:flex; flex-direction:column; gap:15px; background:#f8fafc; }
    .message { max-width:80%; padding:12px 18px; border-radius:18px; word-wrap:break-word; animation:messageSlide .3s ease-out; }
    @keyframes messageSlide { from{opacity:0;transform:translateY(10px);} to{opacity:1;transform:translateY(0);} }
    .user-message { background:linear-gradient(135deg,#4f46e5 0%,#7c3aed 100%); color:#fff; align-self:flex-end; margin-left:auto; }
    .bot-message  { background:#fff; color:#1f2937; align-self:flex-start; border:1px solid #e5e7eb; box-shadow:0 2px 4px rgba(0,0,0,.05); }
    .chat-input-container { padding:20px; background:#fff; border-top:1px solid #e5e7eb; display:flex; gap:12px; align-items:center; }
    .chat-input { flex:1; padding:12px 16px; border:2px solid #e5e7eb; border-radius:25px; font-size:16px; outline:none; transition:border-color .2s; }
    .chat-input:focus{ border-color:#4f46e5; }
    .send-button{ padding:12px 20px; background:linear-gradient(135deg,#4f46e5 0%,#7c3aed 100%); color:#fff; border:none; border-radius:25px; cursor:pointer; font-size:16px; font-weight:600; transition:transform .2s, box-shadow .2s; min-width:80px; }
    .send-button:hover{ transform:translateY(-2px); box-shadow:0 4px 12px rgba(79,70,229,.3); }
    .send-button:disabled{ opacity:.6; cursor:not-allowed; transform:none; }
    .loading{ display:flex; align-items:center; gap:8px; color:#6b7280; font-style:italic; }
    .loading-dots{ display:flex; gap:4px; }
    .loading-dot{ width:6px; height:6px; background:#6b7280; border-radius:50%; animation:loadingDot 1.4s ease-in-out infinite both; }
    .loading-dot:nth-child(1){ animation-delay:-.32s } .loading-dot:nth-child(2){ animation-delay:-.16s }
    @keyframes loadingDot { 0%,80%,100%{ transform:scale(0); opacity:.5 } 40%{ transform:scale(1); opacity:1 } }
  </style>
</head>
<body>
  <div class="chat-container">
    <div class="chat-header">ğŸ¤– AI èŠå¤©åŠ©æ‰‹</div>

    <div class="chat-messages" id="chatMessages">
      <!-- è«‹æ³¨æ„é€™è£¡çš„ URLï¼šç”¨ sporttech_chatbotï¼ˆä¸æ˜¯ sportstechï¼‰ -->
      <input type="hidden" id="webhookUrl" value="https://sushuching.zeabur.app/webhook/sporttech-chatbot"/>
      <div class="bot-message">ğŸ‘‹ ä½ å¥½ï¼æˆ‘æ˜¯ AI åŠ©æ‰‹ï¼Œæœ‰ä»€éº¼å¯ä»¥å¹«åŠ©ä½ çš„å—ï¼Ÿ</div>
    </div>

    <div class="chat-input-container">
      <input type="text" class="chat-input" id="messageInput" placeholder="è¼¸å…¥è¨Šæ¯â€¦" onkeypress="handleKeyPress(event)"/>
      <button class="send-button" onclick="sendMessage()" id="sendButton">ç™¼é€</button>
    </div>
  </div>

  <script>
    let isLoading = false;

    function handleKeyPress(e){ if(e.key==='Enter' && !isLoading){ sendMessage(); } }

    async function sendMessage(){
      const messageInput = document.getElementById('messageInput');
      const webhookUrl   = document.getElementById('webhookUrl').value.trim();
      const message      = messageInput.value.trim();
      if(!message || isLoading) return;
      if(!webhookUrl){ alert('ç³»çµ±é…ç½®éŒ¯èª¤ï¼Œè«‹è¯ç¹«ç®¡ç†å“¡ï¼'); return; }

      addMessage(message,'user'); messageInput.value='';
      setLoading(true); const loadingMessageId = addLoadingMessage();

      try{
        const res = await fetch(webhookUrl,{
          method:'POST',
          headers:{ 'Content-Type':'application/json' },
          body: JSON.stringify({
            question:  message,     // â† æ–°å¢ï¼šn8n ç›´æ¥è®€ question
            chatInput: message,     // â† ä¿ç•™ç›¸å®¹
            timestamp: new Date().toISOString()
          }),
          mode:'cors'
        });

        if(!res.ok){ throw new Error(`HTTP ${res.status}: ${res.statusText}`); }

        const result = await res.json();
        removeLoadingMessage(loadingMessageId);

        // å¤šæ ¼å¼å®¹éŒ¯ï¼šreply / answer / output / text / message
        let botMessage = '';
        if(typeof result === 'string'){ botMessage = result; }
        else if(result.reply){  botMessage = result.reply; }
        else if(result.answer){ botMessage = result.answer; }
        else if(result.output){ botMessage = result.output; }
        else if(result.text){   botMessage = result.text; }
        else if(result.message){botMessage = result.message; }
        else { botMessage = 'æ”¶åˆ°å›æ‡‰ä½†æ ¼å¼ä¸æ˜ç¢º'; }

        addMessage(botMessage || 'æŠ±æ­‰ï¼Œæˆ‘æ²’æœ‰æ”¶åˆ°å›æ‡‰ã€‚','bot');

      }catch(err){
        console.error(err);
        removeLoadingMessage(loadingMessageId);
        let msg = 'ç™¼ç”ŸéŒ¯èª¤ï¼š';
        if(err.name==='TypeError' && err.message.includes('fetch')){
          msg += 'ç„¡æ³•é€£æ¥åˆ°ä¼ºæœå™¨ï¼Œå¯èƒ½æ˜¯ç¶²è·¯æˆ– CORS è¨­å®šå•é¡Œã€‚';
        }else if(err.message.includes('HTTP')){
          msg += err.message;
        }else{
          msg += err.message;
        }
        addMessage(msg+'\n\nè«‹æª¢æŸ¥ï¼š\n1. n8n å·¥ä½œæµç¨‹æ˜¯å¦å·²å•Ÿå‹•\n2. webhook URL æ˜¯å¦æ­£ç¢º\n3. ç¶²è·¯é€£ç·šæ˜¯å¦æ­£å¸¸','bot');
      }finally{
        setLoading(false);
      }
    }

    function addMessage(text,sender){
      const box=document.getElementById('chatMessages');
      const div=document.createElement('div');
      div.className=`message ${sender}-message`;
      div.innerHTML=String(text).replace(/\n/g,'<br>');
      box.appendChild(div); box.scrollTop=box.scrollHeight;
    }
    function addLoadingMessage(){
      const box=document.getElementById('chatMessages');
      const id='loading-'+Date.now(); const div=document.createElement('div');
      div.id=id; div.className='message bot-message loading';
      div.innerHTML=`æ­£åœ¨æ€è€ƒä¸­
        <div class="loading-dots"><div class="loading-dot"></div><div class="loading-dot"></div><div class="loading-dot"></div></div>`;
      box.appendChild(div); box.scrollTop=box.scrollHeight; return id;
    }
    function removeLoadingMessage(id){ const el=document.getElementById(id); if(el) el.remove(); }
    function setLoading(b){ isLoading=b; const btn=document.getElementById('sendButton'); const inp=document.getElementById('messageInput'); btn.disabled=b; inp.disabled=b; btn.textContent=b?'ç™¼é€ä¸­â€¦':'ç™¼é€'; }
  </script>
</body>
</html>

